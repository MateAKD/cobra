#!/bin/bash

echo "ğŸš¨ STARTING EMERGENCY MALWARE CLEANUP ğŸš¨"

# 1. Kill the malicious process
echo "ğŸ”« Killing malicious processes..."
pkill -f .b4nd1d0
pkill -f .esd101
killall -9 .b4nd1d0 2>/dev/null

# 2. Clean Crontab
echo "ğŸ§¹ Cleaning crontab..."
# Backup current crontab
crontab -l > crontab.bak
# Remove lines containing the malware
grep -v ".b4nd1d0" crontab.bak > crontab.clean
# Remove duplicate monitor lines, keep only one
grep -v "monitor-app.sh" crontab.clean > crontab.final
echo "* * * * * /var/www/cobra/monitor-app.sh" >> crontab.final

# Apply new crontab
crontab crontab.final
rm crontab.bak crontab.clean crontab.final

# 3. Delete malicious files
echo "ğŸ—‘ï¸  Deleting malware files..."
rm -rf /tmp/.esd101
rm -rf /tmp/.b4nd1d0

# 4. Verify
echo "âœ… Verification:"
echo "--- Crontab Content ---"
crontab -l
echo "-----------------------"
echo "ğŸ‰ Cleanup Complete. Your server resources should now stay stable."
